<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Life Support Expert System</title>
    <title>(Space Picnic Planner)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px auto;
            max-width: 800px;
            padding: 20px;
            background: #f9f9f9;
        }
        h1 { text-align: center; }
        label { display: block; margin-top: 15px; }
        input, select {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
        }
        button {
            margin-top: 20px;
            padding: 10px 15px;
            font-size: 16px;
        }
        .results {
            margin-top: 30px;
            background: #eef;
            padding: 20px;
            border-radius: 8px;
        }
        .error {
            color: red;
            background: #fee;
            padding: 10px;
            border-radius: 5px;
        }
        .crew-table {
            width: 100%;
            margin-top: 20px;
        }
        .crew-table th, .crew-table td {
            text-align: left;
            padding: 5px;
        }
    </style>
    <script>
        function toggleCO2Options() {
            const scrubberBox = document.getElementById('use_scrubber');
            const recyclerBox = document.getElementById('use_recycler');

            // Enforce mutual exclusivity
            if (scrubberBox.checked) recyclerBox.checked = false;
            if (recyclerBox.checked) scrubberBox.checked = false;

            document.getElementById('scrubber-fields').style.display = scrubberBox.checked ? 'block' : 'none';
            document.getElementById('recycler-fields').style.display = recyclerBox.checked ? 'block' : 'none';
        }
    </script>
</head>
<body>
    <h1>Spacecraft Life Support Planner</h1>

    <!-- Crew Input -->
    <form method="POST" action="/add_or_edit_crew">
        <label for="name">Crew Member Name:</label>
        <input type="text" name="name" required>

        <label for="mass">Body Mass (kg):</label>
        <input type="number" step="0.1" name="mass" required>

        <button type="submit">Add/Update Crew Member</button>
    </form>

    <form method="POST" action="/clear_crew" onsubmit="return confirm('Are you sure you want to clear all crew?');">
        <button style="background: crimson; color: white;">Clear All Crew</button>
    </form>

    <!-- Crew Table -->
    <h2>Crew Roster</h2>
    <table class="crew-table">
        <tr><th>Name</th><th>Mass (kg)</th></tr>
        {% for _, row in crew.iterrows() %}
            <tr><td>{{ row['name'] }}</td><td>{{ row['mass'] }}</td></tr>
        {% endfor %}
    </table>

    <hr>

    <!-- Life Support Input -->
    <form method="POST">
        <label for="duration">Mission Duration (days):</label>
        <input type="number" name="duration" required>

        <label for="activity">Activity Level:</label>
        <select name="activity" required>
            <option value="low">Low</option>
            <option value="moderate">Moderate</option>
            <option value="daily">Daily Exercise</option>
        </select>

        <label for="oxygen_tank_weight_per_kg">O‚ÇÇ Tank Mass per kg (kg):</label>
        <input type="number" name="oxygen_tank_weight_per_kg" value = "1.2" step="0.01" required>

        <label for="nitrogen_tank_weight_per_kg">N‚ÇÇ Tank Mass per kg (kg):</label>
        <input type="number" name="nitrogen_tank_weight_per_kg" value = "1.2" step="0.01" required>

        <label for="hygiene_water_per_day">Hygiene Water per Crew per Day (g):</label>
        <input type="number" name="hygiene_water_per_day" value="1500" required>

        <div id="water-recycler-fields" style="display:none;">
        <label for="water_recycler_efficiency">Water Recycler Efficiency (%):</label>
        <input type="number" name="water_recycler_efficiency" value = "85" step="1">
        <label for="water_recycler_mass">Water Recycler Hardware Weight (kg):</label>
        <input type="number" name="water_recycler_weight" value = "450" step="0.01">
        </div>

        <script>
        document.getElementById('use_water_recycler').addEventListener('change', function() {
            document.getElementById('water-recycler-fields').style.display = this.checked ? 'block' : 'none';
        });
        </script>


        <label for="weight_limit">Life Support Mass Budget (kg):</label>
        <input type="number" name="weight_limit" step="0.01" required>

        <!-- Scrubber/Recycler Toggle -->
        <label>
            <input type="checkbox" id="use_water_recycler" name="use_water_recycler">
            Use Water Recycler
        </label>
        <label>
            <input type="checkbox" id="use_scrubber" name="use_scrubber" onchange="toggleCO2Options()"> Use CO‚ÇÇ Scrubber
        </label>
        <label>
            <input type="checkbox" id="use_recycler" name="use_recycler" onchange="toggleCO2Options()"> Use CO‚ÇÇ Recycler (Sabatier)
        </label>

        <!-- Scrubber Fields -->
        <div id="scrubber-fields" style="display:none;">
            <h3>üìä Scrubber Reference Table</h3>
            <table border="1" cellpadding="8" style="border-collapse: collapse; margin-top: 10px;">
            <thead>
                <tr style="background-color: #eef;">
                <th>Scrubber Type</th>
                <th>CO‚ÇÇ Removal Efficiency (%)</th>
                <th>CO‚ÇÇ Absorption Capacity<br>(kg CO‚ÇÇ / kg scrubber)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                <td>Amine-Based (MEA)</td>
                <td>95‚Äì99%</td>
                <td>0.4‚Äì0.6</td>
                </tr>
                <tr>
                <td>Zeolite-Based</td>
                <td>85‚Äì95%</td>
                <td>0.2‚Äì0.3</td>
                </tr>
                <tr>
                <td>Soda Lime</td>
                <td>80‚Äì90%</td>
                <td>0.2‚Äì0.3</td>
                </tr>
                <tr>
                <td>Activated Carbon</td>
                <td>30‚Äì60%</td>
                <td>0.1‚Äì0.2</td>
                </tr>
                <tr>
                <td>Solid Amine-Based</td>
                <td>90‚Äì98%</td>
                <td>0.3‚Äì0.5</td>
                </tr>
            </tbody>
            </table>
            <label for="co2_scrubber_efficiency">Scrubber Efficiency (% CO‚ÇÇ removed):</label>
            <input type="number" name="co2_scrubber_efficiency" step="0.1">

            <label for="scrubber_weight_per_kg">Scrubber Mass per kg CO‚ÇÇ (kg):</label>
            <input type="number" name="scrubber_weight_per_kg" step="0.01">
        </div>

        <!-- Recycler Fields -->
        <div id="recycler-fields" style="display:none;">
            <label for="co2_recycler_efficiency">Recycler Efficiency (% CO‚ÇÇ ‚Üí O‚ÇÇ):</label>
            <input type="number" name="co2_recycler_efficiency" value = "50" step="0.1">

            <label for="recycler_weight">Recycler Hardware Weight (kg):</label>
            <input type="number" name="recycler_weight" value = "10" step="0.01">
        </div>

        <button type="submit">Calculate Life Support</button>
    </form>

    {% if results %}
        <div class="results">
            {% if results.error %}
                <div class="error">{{ results.error }}</div>
            {% else %}
                <h2>Life Support Summary</h2>
                <p><strong>Total O‚ÇÇ Required:</strong> {{ results.o2_required_kg }} kg</p>
                <p><strong>O‚ÇÇ Reclaimed from CO‚ÇÇ:</strong> {{ results.o2_reclaimed }} kg</p>
                <p><strong>CO‚ÇÇ Generated:</strong> {{ results.co2_generated }} kg</p>
                <p><strong>O‚ÇÇ Tank Mass:</strong> {{ results.o2_tank_mass }} kg</p>
                <p><strong>Scrubber Mass:</strong> {{ results.scrubber_mass }} kg</p>
                <p><strong>Sabatier Recycler Mass:</strong> {{ results.recycler_mass }} kg</p>
                <p><strong>Total N‚ÇÇ Required:</strong> {{ results.n2_required_kg }} kg</p>
                <p><strong>N‚ÇÇ Tank Mass:</strong> {{ results.n2_tank_mass }} kg</p>
                <p><strong>Water (Hygiene Use Only):</strong> {{ results.water_hygiene_raw }} g</p>
                <p><strong>Water (Excreted from Meals):</strong> {{ results.water_excretion }} g</p>
                <p><strong>Water Recovered:</strong> {{ results.water_recovered }} g</p>
                <p><strong>Water Recycler Mass:</strong> {{ results.water_recycler_mass }} kg</p>
                <p><strong>Net Water Mass Needed:</strong> {{ results.water_net }} g</p>
                <p><strong>Gas and Water Mass:</strong> {{ results.get('total_life_support_mass', 'N/A') }} kg</p>
                <p><strong>Cumulative Meal and Beverage Mass:</strong> {{ results.cumulative_meal_mass }} kg</p>
                <p><strong>Combined Life Support Mass:</strong> {{ results.combined_life_support_mass }} kg</p>
                <p><strong>Status:</strong>
                    {% if results.within_limit %}
                        ‚úÖ Within mass limit!
                    {% else %}
                        ‚ùå Exceeds mass limit.
                    {% endif %}
                </p>
            {% endif %}
        </div>
    {% endif %}
</body>
<form action="/setup_foods" method="GET">
    <button type="submit">Edit Food Database ‚Üí</button>
</form>
<form action="/meal_log" method="GET">
    <button>üìÖ View Meal Log from Database</button>
</form>
</html>

